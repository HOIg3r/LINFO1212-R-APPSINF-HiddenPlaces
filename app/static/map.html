<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>HiddenPlaces - Home</title>
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="map.css">
    <link rel="stylesheet" href="popup.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>

</head>
<body>
<header>
    <div class="topnav" id="myTopnav">
        <a href="index.html" class="active">HiddenPlaces</a>
        <a href="index.html">Home</a>
        <a href="login.html">Log-in</a>
        <a href="places.html">Places</a>
        <a href="addPlaces.html">Add places</a>
        <a href="map.html">Map</a>


        <div class="search-box">
            <button class="btn-search"><i class="fas fa-search"></i></button>
            <input type="text" class="input-search" placeholder="Search...">
        </div>


        <div class="dropdown">
            <!--TODO : Put username vertical align-->
            <p class="username">{{username}}</p>
            <img src="img/user.png" alt="Profile picture" id="profile_picture" width="40px" height="40px"
                 class="profile-picture">

            <div class="dropdown-content" id="dropdownProfile">
                <a href="myProfile.html">Mon profil</a>
                <a href="logout.html">Se déconnecter</a>
            </div>
        </div>
    </div>
</header>
    <div id="map"></div>
<script>
    /*Map*/
    var mymap = L.map('map').setView([51.505, -0.09], 13);
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoibGViZWxnZSIsImEiOiJja3djNjk0cXMwN241MnR0M292NGJqcDU5In0.-NAdVQ9n-CIrhhRDd1vv5w'
    }).addTo(mymap);
    var mapgeojson = "{{ mapgeojson }}"
    mapgeojson = mapgeojson.replaceAll('&quot;','"');
    mapgeojson = '{"type": "FeatureCollection","features": ' + mapgeojson + '}'
    mapgeojson = JSON.parse(mapgeojson);
    console.log(mapgeojson);
    var myStyle = {
        "color": "#ff7800",
        "weight": 5,
        "opacity": 0.65
    };
    function onEachFeature(feature, layer) {
        // does this feature have a property named popupContent?
        if (feature.properties && feature.properties.popupContent) {
            layer.bindPopup(feature.properties.popupContent);
        }
    }
    L.geoJSON(mapgeojson, {
        style: myStyle,
        onEachFeature: onEachFeature
    }).addTo(mymap);

    /*PopUp*/
    var btnClose = document.getElementById("btnClose");
    var overlay = document.getElementById("overlay");

    btnClose.addEventListener("click", closePopup);

    function closePopup() {
        overlay.style.display = "none";
    }

    document.addEventListener("keypress", function(event) {
        overlay.style.display = 'none'
    });
</script>

<div style="display:{{style}}" id="overlay" class="overlay">
    <div id="popup-errorMessage" class="popup-errorMessage">
        <h2>Error Message : <span class="btnClose" id="btnClose">&times;</span></h2>
        <h3>{{errorMessage}}</h3>

    </div>
</div>

</body>

<footer>
    <p>&copy; 2021-2022 HiddenPlaces</p>
    <p>Tous droits réservés</p>
</footer>
</html>